# Cigar Counter - 바코드 재고 조사 앱

Flutter로 개발된 바코드 스캔 기반 재고 조사 앱입니다.

## 주요 기능

### 📊 데이터 관리
- **Excel 파일 업로드**: 상품명과 바코드가 포함된 Excel 파일(.xlsx) 업로드
- **진열대 구분 지원**: Excel 파일에서 `##### n차 #####` 형식으로 진열대 자동 인식
- **보류/단종 상품 필터링**: `##### 보류 #####`, `##### 단종 #####` 섹션 자동 제외
- **자동 컬럼 감지**: 상품명, 바코드 컬럼 자동 인식

### 🔢 입력 모드
- **일반 모드**: 1자리 숫자(0~9) 입력 시 자동 확정 및 다음 항목 이동
- **보루 모드**: 1~2자리 숫자(0~99) 입력 가능
  - 1자리: 확인 버튼으로 수동 확정
  - 2자리: 자동 확정 및 다음 항목 이동

### 📋 진행 방식
- **일반 진행**: 엑셀 파일 순서대로 모든 상품 입력
  - 전체 상품을 한 번에 조사할 때 사용
  - 완료 시 자동으로 결과 화면 이동

- **커스텀 진행**: 진열대 선택하여 입력
  - 진열대별로 나눠서 조사 가능
  - 각 진열대의 첫 상품명과 진행률 표시
  - 완료된 진열대는 "완료" 표시 (초록색 테두리)
  - 진열대 완료 시 선택 가능:
    - **다음 진열대**: 진열대 선택 화면으로 이동하여 계속 작업
    - **조사 결과 보기**: 현재까지 입력한 내용 확인

### 📷 바코드 스캔
- **실시간 바코드 스캔**: 카메라로 바코드 스캔하여 상품 찾기
- **수동 바코드 입력**: 바코드를 직접 입력하여 검색

### 📈 진행률 및 통계
- **실시간 진행률**: 현재 작업 진행 상황 표시
- **완료 카운트**: 입력 완료된 상품 수 표시
- **진열대별 진행률**: 커스텀 모드에서 각 진열대별 완료 현황 표시

### 💾 결과 관리
- **Excel 파일 내보내기**: CSV 형식으로 결과 저장
- **데이터 공유**: 공유 기능으로 다른 앱에 전송
- **시간순 정렬**: 커스텀 모드에서 입력 완료 시간순으로 결과 정렬

## 안드로이드 스튜디오 실행 가이드

### 1. 시스템 요구사항
- Android Studio Arctic Fox 이상
- Flutter SDK 3.0.0 이상
- Java 11 이상
- Android SDK API 21 이상

### 2. 프로젝트 설정
```bash
# 의존성 설치
flutter pub get

# Android 빌드 확인
flutter doctor

# 안드로이드 에뮬레이터 또는 실제 기기 연결 확인
flutter devices
```

### 3. 실행
```bash
# 디버그 모드 실행
flutter run

# 릴리즈 모드 실행
flutter run --release

# APK 빌드
flutter build apk --release
```

### 4. 문제 해결

#### 카메라 권한 문제
- Android: `android/app/src/main/AndroidManifest.xml`에 카메라 권한 추가됨
- iOS: `ios/Runner/Info.plist`에 카메라 사용 설명 추가됨

#### Firebase 관련 오류
Firebase 설정이 없어도 앱이 정상 실행됩니다. Firebase 기능은 선택사항입니다.

Firebase를 사용하려면:
1. Firebase 콘솔에서 프로젝트 생성
2. `google-services.json` (Android) 파일 추가
3. `GoogleService-Info.plist` (iOS) 파일 추가

#### 빌드 오류 해결
```bash
# 클린 빌드
flutter clean
flutter pub get

# Android 빌드 확인
cd android
./gradlew clean
./gradlew build

# 캐시 삭제
flutter pub cache repair
```

#### 일반적인 오류 해결

**권한 오류 (Permission Denied)**
- 카메라 권한이 자동으로 요청됩니다
- 거부 시 앱 설정에서 수동으로 권한 허용

**Gradle 빌드 오류**
- JDK 11 사용 확인
- Android SDK 34 설치 확인
- Gradle 캐시 삭제: `cd android && ./gradlew --stop`

**카메라 초기화 실패**
- 에뮬레이터가 아닌 실제 기기 사용 권장
- 카메라 하드웨어가 있는 기기 사용

## 사용법

### 1. Excel 파일 준비

#### 기본 형식
```
| 상품명        | 바코드      |
|--------------|------------|
| 말보로 레드   | 8801234567 |
| 던힐 블루     | 8801234568 |
```

#### 커스텀 모드용 형식 (진열대 구분)
```
| 상품명             | 바코드      |
|-------------------|------------|
| ##### 1차 #####   | 11111111   |
| 말보로 레드        | 8801234567 |
| 던힐 블루          | 8801234568 |
| ##### 2차 #####   | 22222222   |
| 에쎄 체인지        | 8801234569 |
| ##### 보류 #####  | 99999999   |
| 재고 없음          | 0000000000 |
| ##### 단종 #####  | 88888888   |
| 판매 종료          | 1111111111 |
```

**주의사항:**
- 첫 번째 행(1행)에는 "상품명"과 "바코드" 컬럼 제목 필수
- 진열대 구분: `##### n차 #####` 형식 (n은 숫자)
- 보류 상품: `##### 보류 #####` 이후 상품은 무시됨
- 단종 상품: `##### 단종 #####` 이후 상품은 무시됨
- 파일 크기: 10MB 이하

### 2. 앱 사용 절차

#### 단계 1: Excel 파일 업로드
1. 메인 화면에서 "Excel 파일 선택" 버튼 클릭
2. 준비한 Excel 파일(.xlsx) 선택
3. 앱이 자동으로 상품 목록과 진열대 구분 인식

#### 단계 2: 입력 모드 선택
- **일반 모드**: 빠른 입력이 필요할 때 (1자리 숫자 자동 확정)
- **보루 모드**: 정확한 입력이 필요할 때 (1~2자리 숫자, 수동 확정)

#### 단계 3: 진행 방식 선택
- **일반 진행**: 전체 상품을 순서대로 한 번에 조사
- **커스텀 진행**: 진열대를 선택하여 나눠서 조사

#### 단계 4: 수량 입력
1. 화면에 표시된 상품명과 바코드 확인
2. 숫자 버튼을 눌러 수량 입력
3. 바코드 스캔 기능으로 빠르게 상품 찾기 가능
4. "이전" 버튼(<)으로 잘못된 입력 수정
5. "다음" 버튼(>)으로 재고 없는 상품 건너뛰기

#### 단계 5-1: 일반 진행 모드 완료
- 모든 상품 입력 완료 시 자동으로 결과 화면 이동

#### 단계 5-2: 커스텀 진행 모드 완료
1. 선택한 진열대의 모든 상품 입력 완료 시 완료 다이얼로그 표시
2. 선택 옵션:
   - **다음 진열대**: 다른 진열대 선택하여 계속 작업
   - **조사 결과 보기**: 지금까지 입력한 내용 확인

#### 단계 6: 결과 확인 및 저장
1. 입력한 데이터 확인
2. "Excel 저장" 버튼으로 CSV 파일 생성
3. "공유하기" 버튼으로 다른 앱에 전송
4. 커스텀 모드: 입력 완료 시간순으로 정렬되어 표시

## 기술 스택

- **Frontend**: Flutter (Dart)
- **상태 관리**: Provider (ChangeNotifier)
- **카메라**: mobile_scanner
- **바코드**: barcode_widget
- **파일 처리**: file_picker, excel
- **데이터 공유**: share_plus
- **클라우드**: Firebase (선택사항)

## 폴더 구조

```
lib/
├── main.dart                          # 앱 진입점
├── models/                            # 데이터 모델
│   ├── inventory_model.dart           # 재고 상태 관리 (Provider)
│   └── product_entry.dart             # 상품 엔터티 (진열대 정보 포함)
├── screens/                           # 화면 UI
│   ├── upload_screen.dart             # 파일 업로드 및 사용 가이드
│   ├── mode_selection_screen.dart     # 입력 모드 선택 (일반/보루)
│   ├── progress_mode_selection_screen.dart  # 진행 방식 선택 (일반/커스텀)
│   ├── section_selection_screen.dart  # 진열대 선택 (커스텀 모드)
│   ├── entry_screen.dart              # 수량 입력 (진열대 완료 다이얼로그)
│   ├── barcode_scanner_screen.dart    # 바코드 스캔
│   ├── summary_screen.dart            # 결과 요약 및 공유
│   └── statistics_screen.dart         # 통계 화면
├── services/                          # 비즈니스 로직
│   ├── excel_service.dart             # Excel 파일 처리
│   ├── barcode_service.dart           # 바코드 처리
│   ├── local_storage_service.dart     # 로컬 저장소
│   ├── share_service.dart             # 데이터 공유
│   └── permission_service.dart        # 권한 관리
└── widgets/                           # 재사용 컴포넌트
    └── quantity_input.dart            # 수량 입력 위젯 (일반/보루 모드)
```

## 주요 기능 구현 세부사항

### Excel 파일 파싱
- 자동 컬럼 감지: "상품명", "바코드" 키워드로 컬럼 자동 인식
- 진열대 구분 패턴: `RegExp(r'#+\s*(\d+차)\s*#+')`
- 무시 패턴: `RegExp(r'#+\s*(보류|단종)\s*#+')`
- 진열대별 상품 그룹화 및 필터링

### 입력 모드
- **일반 모드**: 1자리 입력 → 즉시 확정 → 다음 항목 이동
- **보루 모드**:
  - 1자리 입력 → 확인 버튼으로 수동 확정
  - 2자리 입력 → 자동 확정 → 다음 항목 이동

### 진행 방식
- **일반 진행**: `_entries` 전체 순회
- **커스텀 진행**:
  - `filteredEntries` getter로 선택된 진열대 상품만 필터링
  - 진행률, 완료 카운트 개별 계산
  - 시간순 정렬 (`recordedAt` 필드 활용)

### 진열대 관리
- 진열대 목록 숫자순 정렬: `int.tryParse(a.replaceAll('차', ''))`
- 완료 진열대 Set 관리: `_completedSections`
- 진열대별 첫 상품명 표시: `getFirstProductBySection()`
- 진행률 표시: 완료 상품 수 / 전체 상품 수

### UI/UX 개선
- 진열대 선택 화면: 카드 형식, 진행률 바, 완료 뱃지
- 진열대 텍스트 크기 차별화:
  - 진열대명("n차"): `titleLarge` 크기
  - 첫 상품명: `bodyMedium` 크기 (약 절반)
- 완료 진열대: 초록색 테두리 및 "완료" 표시

## 데이터 흐름

```
1. Excel 업로드
   ↓
2. 진열대 구분 파싱 (##### n차 ##### 감지)
   ↓
3. 보류/단종 필터링 (##### 보류/단종 ##### 제외)
   ↓
4. 입력 모드 선택 (일반/보루)
   ↓
5. 진행 방식 선택 (일반/커스텀)
   ↓
6-1. 일반 진행: 전체 상품 순회
6-2. 커스텀 진행: 진열대 선택 → 해당 진열대 상품만 입력
   ↓
7. 수량 입력 (바코드 스캔 가능)
   ↓
8-1. 일반: 완료 시 자동으로 결과 화면
8-2. 커스텀: 진열대 완료 → 다음 진열대 or 결과 보기 선택
   ↓
9. 결과 확인 (시간순 정렬 - 커스텀 모드)
   ↓
10. CSV 내보내기 / 공유
```

## 라이선스

MIT License

## 개발자

Withcorn Team
